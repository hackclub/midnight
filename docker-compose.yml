version: '3.8'

services:
  # Nginx Reverse Proxy
  nginx:
    build:
      context: ./nginx
      dockerfile: Dockerfile
    restart: unless-stopped
    networks:
      - midnight-network
    depends_on:
      - lark-ui
      - unified-service

  # Frontend UI - SvelteKit Application
  lark-ui:
    build:
      context: .
      dockerfile: ./lark-ui/Dockerfile
    environment:
      - NODE_ENV=production
      - PORT=5173
    restart: unless-stopped
    networks:
      - midnight-network
    expose:
      - "5173"

  # Unified Service - NestJS API
  unified-service:
    build:
      context: .
      dockerfile: ./owl-api/unified-service/Dockerfile
    environment:
      - NODE_ENV=production
      - PORT=3002
      - MAIL_SERVICE_URL=http://mail-service:3002
    restart: unless-stopped
    networks:
      - midnight-network
    expose:
      - "3002"

networks:
  midnight-network:
    driver: bridge
